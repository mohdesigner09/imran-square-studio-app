<!DOCTYPE html>
<html lang="en">
<head>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>

<script>
  // Auth Guard: Agar user login nahi hai, to Landing Page par bhejo
  const user = localStorage.getItem('imranUser');
  if (!user) {
    window.location.href = 'landing.html';
  }
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMRAN SQUARE - Dashboard</title>

        <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IMRAN SQUARE">
       
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="/resources/icon-152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/resources/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/resources/icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/resources/icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/icon-16.png">
    <link rel="shortcut icon" href="/resources/favicon.ico">



    <script src="https://cdn.tailwindcss.com"></script>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    
<style>
    /* =========================================
       üî• THEME: DARK CINEMATIC (Black & White)
       ========================================= */

    :root { 
        --primary-dark: #030303; 
        --accent-glow: #ffffff; /* Pure White Glow */
        --accent-dim: #a3a3a3; /* Silver */
        --text-primary: #ededed; 
    }

    /* 1. BACKGROUND SETUP */
    body { 
        background-color: #030303 !important;
        color: var(--text-primary); 
        font-family: 'Inter', sans-serif; 
        overflow-x: hidden; 
        position: relative;
    }

    /* Background Image with Blur */
    body::before {
        content: "";
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        
        /* üî• Background Image */
        background-image: url('resources/index bg .jpeg'); 
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        
        /* ‚ú® Blur & Blend Settings */
        filter: blur(4px) brightness(0.7);
        transform: scale(1.05);
        opacity: 0.5;
        z-index: -50;
        pointer-events: none;
    }

    /* =========================================
       üö´üçä ORANGE KILLER (IMPORTANT FIX)
       Ye section zabardasti saare Orange colors ko White/Silver kar dega
       ========================================= */

    /* 1. TEXT (Titles, Percentages) */
    .text-orange-500, .text-orange-400, .text-amber-500, .text-amber-400 {
        color: #ffffff !important;
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.6); /* White Glow */
    }

    /* 2. BUTTONS & BADGES (Backgrounds) */
    .bg-orange-500, .bg-orange-600, .bg-amber-500 {
        background-color: #ffffff !important;
        color: #000000 !important; /* Black Text for contrast */
        border: 1px solid rgba(255, 255, 255, 0.8) !important;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.4) !important; /* White Glow */
    }

    /* 3. BORDERS */
    .border-orange-500, .border-orange-500\/50, .border-amber-500 {
        border-color: rgba(255, 255, 255, 0.5) !important;
    }

    /* 4. GRADIENTS (Progress Bars etc.) */
    .from-orange-500 {
        --tw-gradient-from: #ffffff !important;
        --tw-gradient-to: #999999 !important; /* Fade to Silver */
    }

    /* 5. ICONS INSIDE ORANGE BUTTONS */
    .bg-orange-500 svg, .bg-orange-600 svg {
        stroke: #000000 !important; /* Icons become black on white buttons */
    }

    /* =========================================
       GLASS UI ELEMENTS
       ========================================= */

    /* Project Cards */
    .project-card { 
        background: rgba(15, 15, 15, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        position: relative; z-index: 10;
        transition: all 0.4s ease;
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.8);
    }

    .project-card:hover { 
        border-color: rgba(255, 255, 255, 0.6); 
        transform: translateY(-5px) scale(1.01); 
        box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 1), 0 0 30px rgba(255, 255, 255, 0.15);
    }

    /* Dashboard Stats Cards (Top Row) */
    .dashboard-card {
        background: linear-gradient(180deg, rgba(20,20,20,0.8) 0%, rgba(5,5,5,0.9) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        transition: all 0.3s ease;
    }
    .dashboard-card:hover {
        border-color: rgba(255, 255, 255, 0.4);
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

    /* Toggle Buttons (My Projects / All Projects) */
    #projectScopeToggle button.active-scope {
        background: rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        border: 1px solid rgba(255,255,255,0.3) !important;
        box-shadow: 0 0 15px rgba(255,255,255,0.1);
    }

    /* Nav Bar */
    .nav-bottom { 
        background: rgba(0, 0, 0, 0.9); 
        backdrop-filter: blur(20px); 
        border-top: 1px solid rgba(255,255,255,0.15); 
    }
    .nav-item.active { color: #ffffff !important; text-shadow: 0 0 10px rgba(255,255,255,0.5); }

    /* Floating Action Button (+) Fix */
    .fixed.bottom-24.right-6 {
        background-color: #ffffff !important;
        color: black !important;
        box-shadow: 0 0 30px rgba(255,255,255,0.4) !important;
    }

    /* Edit Mode */
    .delete-btn { display: none !important; } 
    body.edit-mode .delete-btn { display: flex !important; } 
    body.edit-mode .project-card { border: 1px dashed #fff; cursor: move; transform: none !important; }
    
    /* Animations & Fonts */
    .font-display { font-family: 'Playfair Display', serif; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    @keyframes unfoldIn { 0% { opacity: 0; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1); } }
    .animate-paper-unfold { animation: unfoldIn 0.5s ease forwards; }
    
    /* Scrollbars */
    .custom-scroll::-webkit-scrollbar { width: 0px; }
</style>
</head>
<body>
    <canvas class="film-grain" id="filmGrain"></canvas>

    <!-- üî• FIXED HEADER (Updated Theme: Black & White) -->
    <header class="fixed top-0 left-0 w-full z-[100] bg-black/80 backdrop-blur-md border-b border-white/10 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">

            <!-- Logo Section -->
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-xl border border-white/10 bg-white/5 flex items-center justify-center overflow-hidden">
                    <img src="resources/icon-32.png" alt="Logo" class="w-5 h-5 opacity-90 invert">
                </div>
                <div class="hidden md:block leading-tight">
                    <p class="text-[10px] text-gray-500 uppercase tracking-wider">Studio</p>
                    <p class="text-xs font-bold text-white tracking-wider font-display">IMRAN SQUARE</p>
                </div>
            </div>

            <!-- Right Section -->
            <div class="flex items-center gap-4">
                
                <!-- Search Bar -->
                <div class="relative w-60 hidden sm:block">
                    <input type="text" placeholder="Search projects..." 
                        class="w-full bg-white/5 border border-white/10 rounded-full py-2 pl-4 pr-10 text-xs text-white placeholder-gray-500 focus:outline-none focus:border-white/40 transition">
                    <svg class="w-4 h-4 text-gray-500 absolute right-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                </div>

                <!-- Avatar & Menu -->
                <div class="relative group">
                    <button id="userAvatarButton" class="w-9 h-9 rounded-full bg-white text-black border border-white/20 flex items-center justify-center text-xs font-bold shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:scale-105 transition">
                        <span id="userAvatarFallback">IS</span>
                        <img id="userAvatarImg" src="" class="hidden w-full h-full object-cover rounded-full">
                    </button>

                    <!-- User Menu Dropdown -->
                    <div id="userMenu" class="hidden absolute top-12 right-0 w-60 bg-[#0a0a0a] border border-white/10 rounded-xl shadow-2xl z-50 backdrop-blur-xl">
                        <div class="p-4 border-b border-white/5">
                            <p id="userMenuName" class="text-white font-semibold text-sm">User</p>
                            <p id="userMenuEmail" class="text-xs text-gray-500 truncate">email@example.com</p>
                        </div>
                        
                        <a href="account.html" id="userMenuAccount" class="block w-full text-left px-4 py-3 text-sm text-gray-300 hover:bg-white/5 transition decoration-0">
                            Account Settings
                        </a>
                        
                        <button id="userMenuSignOut" class="w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-white/5 transition border-t border-white/5">
                            Sign Out
                        </button>
                    </div>
                </div>

            </div>

        </div>
    </header>

     <!-- üî• NEW: UPDATE NOTIFICATION TOAST (Hidden by default) -->
    <div id="updateToast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-[#0a0a0a]/90 backdrop-blur-xl border border-white/20 text-white pl-5 pr-2 py-2 rounded-full shadow-[0_0_30px_rgba(0,0,0,0.8)] flex items-center gap-6 z-[9999] translate-y-24 opacity-0 transition-all duration-500 pointer-events-none">
        <div class="flex flex-col">
            <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">System</span>
            <span class="text-xs font-medium text-white">New version available</span>
        </div>
        <button onclick="window.location.reload()" class="bg-white text-black text-[10px] font-bold px-4 py-2 rounded-full hover:scale-105 transition-transform shadow-[0_0_15px_rgba(255,255,255,0.3)]">
            UPDATE NOW
        </button>
    </div>

    <!-- üî• NEW: AUTO-UPDATE SCRIPT -->
    <script>
        (function() {
            let currentETag = null;

            // 1. Initial Check: Get current version hash from server headers
            fetch(window.location.href, { method: 'HEAD', cache: 'no-store' })
                .then(res => {
                    currentETag = res.headers.get('etag');
                    console.log('Current Version:', currentETag);
                })
                .catch(e => console.log('Update check skipped (local/error)'));

            // 2. Periodic Check: Every 30 seconds
            setInterval(() => {
                if (!currentETag) return;
                
                // Fetch ONLY headers to save data
                fetch(window.location.href, { method: 'HEAD', cache: 'no-store' })
                    .then(res => {
                        const newETag = res.headers.get('etag');
                        // If ETag changes, it means you deployed a new version!
                        if (newETag && newETag !== currentETag) {
                            showUpdateNotification();
                        }
                    })
                    .catch(e => console.log('Background check failed'));
            }, 30000); // 30 Seconds Interval

            function showUpdateNotification() {
                const toast = document.getElementById('updateToast');
                if(toast) {
                    // Show animation
                    toast.classList.remove('translate-y-24', 'opacity-0', 'pointer-events-none');
                    // Play a subtle sound (Optional)
                    // const audio = new Audio('resources/notification.mp3'); audio.play().catch(e=>{});
                }
            }
        })();
    </script>
    
       <!-- Main hero/layout -->
    <div class="hero-bg flex flex-col">
        <div
          class="content-layer flex-1 w-full max-w-6xl mx-auto
                 px-4 sm:px-6
                 pt-4 sm:pt-6
                 pb-20 sm:pb-24
                 space-y-6">

            <!-- Mobile search (chhota screen par hi dikhega) -->
            <div class="md:hidden mb-4">
                <div class="relative">
                    <div class="absolute top-1/2 left-3 -translate-y-1/2 pointer-events-none">
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                 <input
    type="text"
    placeholder="Search projects..."
    class="w-full bg-[#1a1a1a] border border-[#2a2a2a] text-white pl-9 pr-3 py-2.5 rounded-lg text-sm focus:border-orange-500 focus:outline-none">

                </div>
            </div>

            <!-- yahan se tumhara baaki content (summary cards, Active Projects, Recent Activity, etc.) -->


            
           <div class="grid grid-cols-3 gap-2 sm:gap-4 mb-6">

    <!-- Projects -->
    <div class="relative overflow-hidden rounded-2xl bg-black/70 backdrop-blur-xl border border-white/5 shadow-[0_22px_60px_rgba(0,0,0,0.95)]">

        <div class="absolute inset-0 bg-gradient-to-br from-orange-500/10 via-transparent to-black/60 pointer-events-none"></div>
        <div class="relative px-5 py-4 flex flex-col items-center">
            <div class="text-[11px] tracking-[0.25em] uppercase text-gray-400 mb-1">Projects</div>
            <div class="text-4xl font-semibold text-orange-400 leading-none mb-2" id="project-count">12</div>
            <div class="flex items-center gap-2 text-[11px] text-gray-500">
                <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(16,185,129,0.9)]"></span>
                <span>4 active</span>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <div class="relative overflow-hidden rounded-2xl bg-black/70 backdrop-blur-xl border border-white/5 shadow-[0_22px_60px_rgba(0,0,0,0.95)]">

        <div class="absolute inset-0 bg-gradient-to-br from-sky-500/10 via-transparent to-black/60 pointer-events-none"></div>
        <div class="relative px-5 py-4 flex flex-col items-center">
            <div class="text-[11px] tracking-[0.25em] uppercase text-gray-400 mb-1">Scripts</div>
            <div class="text-4xl font-semibold text-orange-400 leading-none mb-2" id="script-count">54</div>
            <div class="flex items-center gap-2 text-[11px] text-gray-500">
                <span class="w-1.5 h-1.5 rounded-full bg-sky-400 shadow-[0_0_8px_rgba(56,189,248,0.9)]"></span>
                <span>10 in progress</span>
            </div>
        </div>
    </div>

    <!-- Videos -->
    <div class="relative overflow-hidden rounded-2xl bg-black/70 backdrop-blur-xl border border-white/5 shadow-[0_22px_60px_rgba(0,0,0,0.95)]">

        <div class="absolute inset-0 bg-gradient-to-br from-amber-500/12 via-transparent to-black/60 pointer-events-none"></div>
        <div class="relative px-5 py-4 flex flex-col items-center">
            <div class="text-[11px] tracking-[0.25em] uppercase text-gray-400 mb-1">Videos</div>
            <div class="text-4xl font-semibold text-orange-400 leading-none mb-2" id="video-count">8</div>
            <div class="flex items-center gap-2 text-[11px] text-gray-500">
                <span class="w-1.5 h-1.5 rounded-full bg-amber-400 shadow-[0_0_8px_rgba(251,191,36,0.9)]"></span>
                <span>3 rendering</span>
            </div>
        </div>
    </div>
</div>

            
<div class="mb-6">
  <div class="flex items-center justify-between mb-3 sm:mb-4">
    
    <div class="flex items-center gap-3">
      <h2 class="font-display text-lg sm:text-xl font-semibold text-white">Active Projects</h2>
      
      <div id="projectScopeToggle" class="inline-flex bg-black/40 border border-white/10 rounded-full px-1 py-1 text-[11px]">
        <button data-scope="my" class="px-3 py-1 rounded-full active-scope transition-all bg-orange-500/20 text-orange-400">My</button>
        <button data-scope="all" class="px-3 py-1 rounded-full transition-all text-gray-400 hover:text-white">All</button>
      </div>
    </div>

    <div class="flex items-center gap-4">
      
      <button id="edit-mode-btn" onclick="toggleEditMode()" 
              class="text-gray-400 hover:text-white transition text-sm" 
              title="Edit Projects">
        <i class="fa-solid fa-pencil"></i>
      </button>

      <button class="text-orange-500 hover:text-orange-400 text-sm font-medium transition">View All</button>
    </div>
  </div>
  
  <div class="scroll-wrapper">
    <div id="projectCards" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-4" style="overflow-y: auto; max-height: calc(100vh - 500px);"></div>
  </div>
</div>


            <div class="mb-6">
                <h2 class="font-display text-xl font-semibold mb-4">Recent Activity</h2>
                <div class="space-y-3 pl-4 border-l border-gray-700">
                    <div class="mb-3"><div class="text-sm text-white">AI analyzed "Midnight City Chronicles"</div><div class="text-xs text-gray-400 font-mono">2 hours ago</div></div>
                    <div class="mb-3"><div class="text-sm text-white">Added 3 videos to "Neon Dreams"</div><div class="text-xs text-gray-400 font-mono">4 hours ago</div></div>
                </div>
            </div>
        </div>
    </div>

    <button id="fabButton"
  class="fixed bottom-24 sm:bottom-24 right-4 sm:right-6
         w-14 h-14 bg-orange-500 rounded-full flex items-center justify-center
         shadow-lg z-50 text-black hover:scale-110 transition-transform">
  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
  </svg>
</button>

<!-- Create New Project Modal -->
<div id="projectModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
  <div class="relative w-full max-w-md">
    <!-- Outer glow -->
    <div class="absolute -inset-4 bg-gradient-to-br from-orange-500/20 via-transparent to-black/80 rounded-3xl blur-2xl opacity-70 pointer-events-none"></div>

    <!-- Card -->
    <div class="relative bg-[#101010] border border-white/10 rounded-3xl px-8 py-7 shadow-[0_22px_60px_rgba(0,0,0,0.95)]">
      <!-- Top accent -->
      <div class="absolute inset-x-8 -top-px h-px bg-gradient-to-r from-transparent via-orange-400/70 to-transparent"></div>

      <!-- Header -->
      <header class="mb-6">
        <p class="text-[11px] uppercase tracking-[0.25em] text-orange-400/80 mb-1">Project setup</p>
        <h2 class="text-2xl font-display font-semibold text-white drop-shadow-sm">Create New Project</h2>
      </header>

      <!-- Title Input -->
      <div class="mb-5">
        <label class="flex items-center justify-between text-xs text-gray-400 mb-1.5">
          <span>Project Title</span>
          <span class="text-[10px] uppercase tracking-wide text-gray-500">Required</span>
        </label>
        <div class="relative">
          <input
            type="text"
            id="projectTitle"
            placeholder="eg. Midnight City Chronicles"
            class="w-full bg-[#141414] border border-[#262626] rounded-xl px-4 py-2.5 text-sm text-white placeholder-gray-500 focus:border-orange-500 focus:ring-1 focus:ring-orange-500/50 outline-none transition"
          />
        </div>
        <p id="titleError" class="text-[11px] text-red-400 mt-1 hidden">Please enter a project title.</p>
      </div>

      <!-- Genre Dropdown -->
      <div class="mb-6">
        <label class="flex items-center justify-between text-xs text-gray-400 mb-1.5">
          <span>Genre</span>
          <span class="text-[10px] uppercase tracking-wide text-gray-500">Optional</span>
        </label>
        <div class="relative">
          <select
            id="projectGenre"
            class="w-full bg-[#141414] border border-[#262626] rounded-xl px-4 py-2.5 text-sm text-white focus:border-orange-500 focus:ring-1 focus:ring-orange-500/50 outline-none appearance-none pr-9"
          >
            <option value="Film Noir">Film Noir</option>
            <option value="Sci-Fi">Sci‚ÄëFi</option>
            <option value="Thriller">Thriller</option>
            <option value="Documentary">Documentary</option>
            <option value="Drama">Drama</option>
            <option value="Action">Action</option>
            <option value="Comedy">Comedy</option>
            <option value="Horror">Horror</option>
            <option value="Other">Other</option>
          </select>
          <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs">‚ñæ</span>
        </div>
      </div>

      <!-- Buttons -->
      <div class="mt-2 flex gap-3">
  <button
    id="cancelModal"
    class="flex-1 h-11 rounded-xl text-sm font-medium text-gray-300 border border-white/10 bg-transparent hover:bg-white/5 transition"
  >
    Cancel
  </button>

  <!-- Create: deep orange gradient -->
  <button
    id="createProject"
    class="flex-1 h-11 rounded-xl text-sm font-semibold text-black
           bg-[radial-gradient(circle_at_20%_0%,#ffb27a_0,#ff7a3b_35%,#ff4b1f_100%)]
           shadow-[0_0_22px_rgba(255,120,60,0.7)]
           hover:shadow-[0_0_30px_rgba(255,120,60,0.95)]
           hover:translate-y-[1px]
           transition"
  >
    Create
  </button>

  <!-- Create & Open: warm gold gradient -->
  <button
    id="createAndOpen"
    class="flex-1 h-11 rounded-xl text-sm font-semibold text-black
           bg-[radial-gradient(circle_at_20%_0%,#ffe9a3_0,#ffd45a_35%,#ffb200_100%)]
           shadow-[0_0_22px_rgba(255,200,80,0.7)]
           hover:shadow-[0_0_30px_rgba(255,210,100,0.95)]
           hover:translate-y-[1px]
           transition"
  >
    Create &amp; Open
  </button>
</div>




    <nav class="nav-bottom fixed bottom-0 left-0 right-0 px-4 py-3 z-40">
        <div class="flex justify-around items-center">
            <a href="index.html" class="nav-item active flex flex-col items-center space-y-1"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg><span class="text-xs">Projects</span></a>
            <a href="scripts.html" class="nav-item text-gray-500 flex flex-col items-center space-y-1"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg><span class="text-xs">Scripts</span></a>
            <a href="footage.html" class="nav-item text-gray-500 flex flex-col items-center space-y-1"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17,10.5V7A1,1 0 0,0 16,6H4A1,1 0 0,0 3,7V17A1,1 0 0,0 4,18H16A1,1 0 0,0 17,17V13.5L21,17.5V6.5L17,10.5Z"/></svg><span class="text-xs">Footage</span></a>
            <a href="ai-tools.html" class="nav-item text-gray-500 flex flex-col items-center space-y-1"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2Z"/></svg><span class="text-xs">AI Tools</span></a>
        </div>
    </nav>

    <!-- Account Settings Panel -->
<div id="accountPanelOverlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 hidden"></div>

<div id="accountPanel" class="fixed top-0 right-0 h-full w-full max-w-md bg-[#050505] border-l border-orange-500/40 shadow-2xl z-50 translate-x-full transition-transform duration-300">
  <div class="flex items-center justify-between px-6 py-4 border-b border-white/10">
    <div>
      <p class="text-sm uppercase tracking-[0.2em] text-orange-400">Account</p>
      <h2 class="text-xl font-semibold text-white">Profile & preferences</h2>
    </div>
    <button id="accountPanelClose" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-300">
      ‚úï
    </button>
  </div>

  <div class="px-6 py-5 space-y-6 overflow-y-auto h-[calc(100%-64px)]">
    <!-- Profile -->
    <section class="bg-white/5 border border-white/10 rounded-2xl p-4 flex gap-4 items-center">
      <div class="w-14 h-14 rounded-full overflow-hidden border border-orange-400/70 bg-black/70 flex items-center justify-center">
        <img id="panelAvatarImg" src="" class="w-full h-full object-cover hidden" alt="Avatar">
        <span id="panelAvatarFallback" class="text-lg font-semibold text-orange-300">U</span>
      </div>
      <div class="flex-1">
        <p id="panelName" class="text-white font-semibold text-sm">User name</p>
        <p id="panelEmail" class="text-xs text-gray-400 truncate">email@example.com</p>
        <span id="panelRole" class="inline-block mt-1 px-2 py-0.5 rounded-full text-[10px] uppercase tracking-wide bg-orange-500/10 text-orange-300 border border-orange-500/40">User</span>
      </div>
      <button id="panelChangeAvatar" class="text-[11px] px-2 py-1 rounded-lg border border-white/15 text-gray-200 hover:bg-white/5">
        Change
      </button>
      <input id="panelAvatarInput" type="file" accept="image/*" class="hidden">
    </section>

    <!-- Appearance -->
    <section class="bg-white/5 border border-white/10 rounded-2xl p-4 space-y-3">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs font-semibold text-gray-200">Appearance</p>
          <p class="text-[11px] text-gray-400">Choose how IMRAN SQUARE looks.</p>
        </div>
      </div>
      <div class="flex gap-2">
        <button id="themeAdvanced" class="flex-1 px-3 py-2 rounded-xl border border-orange-500/60 bg-orange-500/10 text-xs text-orange-100">
          Advanced (Cinematic)
        </button>
        <button id="themeBasic" class="flex-1 px-3 py-2 rounded-xl border border-white/15 bg-black/60 text-xs text-gray-200">
          Basic (Day / Light)
        </button>
      </div>
    </section>

    <!-- Session -->
    <section class="bg-white/5 border border-white/10 rounded-2xl p-4 space-y-3">
      <p class="text-xs font-semibold text-gray-200">Session</p>
      <button id="panelSignOut" class="w-full text-left px-3 py-2 rounded-xl border border-red-500/40 text-xs text-red-300 hover:bg-red-500/10">
        Sign out from this device
      </button>
    </section>
  </div>
</div>




<script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log("‚úÖ Main Script Loaded: Fixing Avatar Button...");

    // 1. IDs Define karo (Jo humne Header mein diye the)
    const avatarBtn = document.getElementById('userAvatarButton');
    const userMenu = document.getElementById('userMenu');
    
    // 2. Data Load karo (LocalStorage se)
    const userStr = localStorage.getItem('imranUser');
    
    if (userStr) {
        const user = JSON.parse(userStr);
        
        // A. Initials Set karo (Header mein)
        const initials = (user.firstName?.[0] || '') + (user.lastName?.[0] || '');
        const fallbackEl = document.getElementById('userAvatarFallback');
        if(fallbackEl) fallbackEl.textContent = initials || 'IS';

        // B. Menu ke andar Naam/Email Set karo
        if(document.getElementById('userMenuName')) 
            document.getElementById('userMenuName').textContent = user.username || 'User';
        
        if(document.getElementById('userMenuEmail')) 
            document.getElementById('userMenuEmail').textContent = user.email || '';

        // C. Welcome Text Set karo
        if(document.getElementById('dashboardUserName'))
            document.getElementById('dashboardUserName').textContent = user.username || 'Creator';
    }

    // 3. Button Click Logic (Hammer Fix üî®)
    if (avatarBtn && userMenu) {
        // Clone node to remove old broken listeners from dashboard-advanced.js
        const newAvatarBtn = avatarBtn.cloneNode(true);
        avatarBtn.parentNode.replaceChild(newAvatarBtn, avatarBtn);

        // Naya listener lagao
        newAvatarBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log("üîò Avatar Clicked!"); 
            userMenu.classList.toggle('hidden');
        });

        // Bahar click karne par band karo
        document.addEventListener('click', (e) => {
            if (!newAvatarBtn.contains(e.target) && !userMenu.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });
        
        console.log("‚úÖ Avatar Button Logic Attached Successfully");
    } else {
        console.error("‚ùå Avatar Button or Menu NOT found in HTML");
    }

    // 4. Sign Out Logic
    const signOutBtn = document.getElementById('userMenuSignOut');
    if (signOutBtn) {
        signOutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            console.log("üëã Signing Out...");
            localStorage.removeItem('imranUser');
            localStorage.removeItem('userEmail');
            window.location.href = 'landing.html';
        });
    }
  });
</script>

<script>
    (function() {
        try {
            const userStr = localStorage.getItem('imranUser');
            if (userStr) {
                const user = JSON.parse(userStr);
                
                // Check agar Admin hai
                if (user.email === 'mohdesigner09@gmail.com' || user.role === 'admin') {
                    
                    // Button Create Karo
                    const btn = document.createElement('a');
                    btn.href = 'admin.html';
                    btn.innerHTML = `
                        <span style="font-size:16px">‚ö°</span> 
                        <span style="font-weight:600; letter-spacing:1px">GOD MODE</span>
                    `;
                    
                    // Styling (Floating Red Button)
                    btn.style.cssText = `
                        position: fixed;
                        bottom: 30px;
                        right: 30px;
                        background: rgba(220, 38, 38, 0.9);
                        color: white;
                        padding: 12px 20px;
                        border-radius: 9999px;
                        border: 1px solid rgba(255,255,255,0.2);
                        z-index: 9999;
                        text-decoration: none;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        box-shadow: 0 0 20px rgba(220, 38, 38, 0.6);
                        backdrop-filter: blur(5px);
                        transition: all 0.3s ease;
                        font-family: sans-serif;
                        cursor: pointer;
                    `;

                    // Hover Effect
                    btn.onmouseover = () => {
                        btn.style.transform = 'scale(1.05) translateY(-2px)';
                        btn.style.boxShadow = '0 0 30px rgba(220, 38, 38, 0.8)';
                    };
                    btn.onmouseout = () => {
                        btn.style.transform = 'scale(1) translateY(0)';
                        btn.style.boxShadow = '0 0 20px rgba(220, 38, 38, 0.6)';
                    };

                    document.body.appendChild(btn);
                }
            }
        } catch (e) {
            console.error("Admin check failed", e);
        }
    })();
</script>
<!-- ADMIN BUTTON & ANNOUNCEMENT SCRIPT (Paste before </body> in index.html) -->
<script>
    (function() {
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:10000' : 'https://imran-square-studio.onrender.com';

        // 1. GOD MODE BUTTON (Floating) - Sirf Admin ko dikhega
        try {
            const userStr = localStorage.getItem('imranUser');
            if (userStr) {
                const user = JSON.parse(userStr);
                
                // Check agar Admin hai
                if (user.email === 'mohdesigner09@gmail.com' || user.role === 'admin') {
                    const btn = document.createElement('a');
                    btn.href = 'admin.html';
                    btn.innerHTML = `<span style="font-size:16px">‚ö°</span><span style="font-weight:600; letter-spacing:1px">GOD MODE</span>`;
                    btn.style.cssText = `position: fixed; bottom: 30px; right: 30px; background: rgba(220, 38, 38, 0.9); color: white; padding: 12px 20px; border-radius: 9999px; border: 1px solid rgba(255,255,255,0.2); z-index: 9999; text-decoration: none; display: flex; align-items: center; gap: 8px; box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); backdrop-filter: blur(5px); transition: all 0.3s ease; font-family: sans-serif; cursor: pointer;`;
                    btn.onmouseover = () => { btn.style.transform = 'scale(1.05) translateY(-2px)'; };
                    btn.onmouseout = () => { btn.style.transform = 'scale(1) translateY(0)'; };
                    document.body.appendChild(btn);
                }
            }
        } catch (e) {}

        // 2. üì¢ GLOBAL ANNOUNCEMENT CHECKER - Sabko dikhega
        async function checkAnnouncement() {
            try {
                const res = await fetch(`${API_BASE}/api/get-announcement`);
                const data = await res.json();
                
                if (data.success && data.announcement && data.announcement.message) {
                    showAnnouncement(data.announcement);
                }
            } catch(e) {}
        }

        function showAnnouncement(ann) {
            const existing = document.getElementById('global-announcement');
            if(existing) existing.remove();

            const banner = document.createElement('div');
            banner.id = 'global-announcement';
            
            let bg = '#3b82f6'; // Info (Blue)
            if(ann.type === 'warning') bg = '#eab308'; // Yellow
            if(ann.type === 'alert') bg = '#ef4444'; // Red

            banner.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%;
                background: ${bg}; color: white; z-index: 10000;
                padding: 12px; text-align: center; font-family: sans-serif; font-weight: 500;
                box-shadow: 0 4px 10px rgba(0,0,0,0.3); animation: slideDown 0.5s ease-out;
                display: flex; justify-content: center; align-items: center; gap: 15px;
            `;
            
            banner.innerHTML = `
                <span>üì¢ ${ann.message}</span>
                <button onclick="this.parentElement.remove()" style="background:none;border:none;color:white;cursor:pointer;font-size:18px;opacity:0.8">‚úï</button>
                <style>@keyframes slideDown { from {transform: translateY(-100%)} to {transform: translateY(0)} }</style>
            `;
            
            document.body.appendChild(banner);
        }

        // Check on load
        checkAnnouncement();

    })();


let isEditMode = false;

    function toggleEditMode() {
        isEditMode = !isEditMode;
        
        const btn = document.getElementById('edit-mode-btn');
        const container = document.getElementById('projectCards');
        
        // Safety Check
        if (!container || container.children.length === 0) {
            console.log("No projects to edit.");
            return;
        }

        const cards = Array.from(container.children); // Saare cards uthao

        if (isEditMode) {
            // --- ENTER EDIT MODE ---
            
            // 1. Change Icon to Green Tick
            if(btn) {
                btn.innerHTML = `<i class="fa-solid fa-check"></i>`;
                btn.className = "text-green-500 hover:text-green-400 transition text-sm scale-110";
            }

            // 2. Har Card par Button Lagao
            cards.forEach(card => {
                // Card ka purana Click Action (ID nikalne ke liye)
                const originalOnClick = card.getAttribute('onclick');
                
                // Agar pehle se process nahi hua hai
                if (originalOnClick && !card.dataset.originalClick) {
                    
                    // ID Nikalo (Regex se 'id=XYZ' dhoondo)
                    let projId = "";
                    if (originalOnClick.includes('?id=')) {
                        projId = originalOnClick.split('?id=')[1].split("'")[0];
                    }

                    if (projId) {
                        // Click save karo aur disable kar do (taaki page na khule)
                        card.dataset.originalClick = originalOnClick;
                        card.removeAttribute('onclick'); 
                        
                        // Shake Effect Add Karo
                        card.classList.add('animate-pulse', 'ring-1', 'ring-red-500/50');

                        // OVERLAY BUTTONS HTML CREATE KARO
                        const overlay = document.createElement('div');
                        overlay.className = 'editor-overlay absolute inset-0 bg-black/80 backdrop-blur-[2px] flex items-center justify-center gap-4 z-20 animate-fade-in';
                        overlay.innerHTML = `
                            <button onclick="renameProjectDirect(event, '${projId}')" 
                                    class="w-10 h-10 rounded-full bg-blue-600 hover:bg-blue-500 text-white flex items-center justify-center shadow-lg transform hover:scale-110 transition">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button onclick="deleteProjectDirect(event, '${projId}', this)" 
                                    class="w-10 h-10 rounded-full bg-red-600 hover:bg-red-500 text-white flex items-center justify-center shadow-lg transform hover:scale-110 transition">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        `;
                        
                        // Card me ghusa do
                        card.appendChild(overlay);
                    }
                }
            });

        } else {
            // --- EXIT EDIT MODE (RESET) ---

            // 1. Icon Wapas Pencil
            if(btn) {
                btn.innerHTML = `<i class="fa-solid fa-pencil"></i>`;
                btn.className = "text-gray-400 hover:text-white transition text-sm";
            }

            // 2. Cards ko Normal Karo
            cards.forEach(card => {
                // Overlay hatao
                const overlay = card.querySelector('.editor-overlay');
                if (overlay) overlay.remove();

                // Shake effect hatao
                card.classList.remove('animate-pulse', 'ring-1', 'ring-red-500/50');

                // Click wapas lagao (Agar save kiya tha)
                if (card.dataset.originalClick) {
                    card.setAttribute('onclick', card.dataset.originalClick);
                    delete card.dataset.originalClick;
                }
            });
        }
    }

    // --- ACTIONS ---

    // 1. RENAME
    async function renameProjectDirect(event, projectId) {
        event.stopPropagation(); // Parent click roko
        
        // Find Card Title Element
        // Hum DOM traverse karke title dhoond rahe hain
        const btn = event.target.closest('button');
        const card = btn.closest('.bg-\\[\\#1a1a1a\\]'); // Parent Card
        const titleEl = card.querySelector('h3');
        const oldName = titleEl ? titleEl.innerText : "Project";

        const newName = prompt("Rename Project:", oldName);
        
        if (newName && newName.trim() !== "" && newName !== oldName) {
            try {
                // Update UI Immediately
                if(titleEl) titleEl.innerText = newName.trim();

                // Update DB
                await db.collection('projects').doc(projectId).update({ title: newName.trim() });
            } catch (error) {
                console.error(error);
                alert("‚ùå Update Failed");
            }
        }
    }

    // 2. DELETE
    async function deleteProjectDirect(event, projectId, btnElement) {
        event.stopPropagation();
        
        if (confirm("‚ö†Ô∏è Permanently delete this project?")) {
            try {
                // Remove UI Immediately (Fast feel ke liye)
                const card = btnElement.closest('.relative');
                if(card) card.remove();

                // Delete from DB
                await db.collection('projects').doc(projectId).delete();
                console.log("üóëÔ∏è Deleted:", projectId);
                
                // Agar saare cards delete ho gaye to empty message dikhao
                const container = document.getElementById('projectCards');
                if(container && container.children.length === 0) {
                    container.innerHTML = `<p class="text-gray-500 text-center col-span-full py-10">No active projects.</p>`;
                }

            } catch (error) {
                console.error(error);
                alert("‚ùå Delete Failed");
            }
        }
    }

</script>

 <div id="dashToast" class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 px-4 py-2 rounded-full bg-white/90 text-xs text-black shadow-lg z-50">
        Welcome back.
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>



    <script src="main.js"></script>
    <script src="dashboard-advanced.js"></script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .catch((err) => console.error('SW Fail:', err));
        });
      }
    </script>
</body>
</html>