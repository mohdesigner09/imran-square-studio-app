<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor - IMRAN SQUARE</title>

        <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ff6b35">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="IMRAN SQUARE">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="/resources/icon-152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/resources/icon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/resources/icon-192.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/resources/icon-192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/icon-16.png">
    <link rel="shortcut icon" href="/resources/favicon.ico">

    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary-dark: #050505; --accent-orange: #ff6b35; }
        body { background: var(--primary-dark); color: white; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .font-display { font-family: 'Playfair Display', serif; }
        
        .hero-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 30%, #151515 0%, #000000 100%); z-index: -2; }
        .hero-bg::after { content: ''; position: absolute; inset: 0; background: url('resources/hero-film-studio.png') center/cover; opacity: 0.15; mix-blend-mode: overlay; z-index: -1; }
        .film-grain { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.04; z-index: 0; }

        /* Cards */
        .section-card {
            background: linear-gradient(180deg, rgba(20, 20, 20, 0.95) 0%, rgba(5, 5, 5, 0.98) 100%);
            backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.03); border-top: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 16px; box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.8);
            transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); transform-style: preserve-3d; overflow: hidden; position: relative;
        }
        .section-card:hover { border-color: rgba(255, 107, 53, 0.4); transform: translateY(-5px) scale(1.01); z-index: 10; box-shadow: inset 0 1px 0 0 rgba(255, 107, 53, 0.6), 0 0 60px -10px rgba(255, 107, 53, 0.15), 0 30px 60px -15px rgba(0, 0, 0, 1); }
        .section-card .border-b { border-color: rgba(255, 255, 255, 0.05); }

        /* Full State Glow */
        .section-card.card-full { border-color: rgba(34, 197, 94, 0.3); box-shadow: inset 0 0 20px rgba(34, 197, 94, 0.1); }

        /* Edit Mode Styles */
        body.edit-mode .section-card { border: 1px dashed var(--accent-orange); cursor: move; background: rgba(20, 20, 20, 1); } 
        .delete-btn, .upload-area { display: none; }
        body.edit-mode .delete-btn { display: block; }
        body.edit-mode .upload-area { display: flex; }
        [contenteditable="true"] { border-bottom: 1px dashed var(--accent-orange); outline: none; color: var(--accent-orange); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        /* --- UPLOAD QUEUE --- */
        #uploadQueue { position: fixed; bottom: 20px; right: 20px; width: 300px; display: flex; flex-direction: column; gap: 8px; z-index: 100; }
        .upload-item { background: #111; border: 1px solid rgba(255, 255, 255, 0.15); border-left: 3px solid var(--accent-orange); padding: 12px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); animation: slideIn 0.3s ease-out; color: white; font-size: 0.85rem; }
        .upload-item.success { border-left-color: #22c55e; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }

        /* --- HOLOGRAPHIC RING CSS --- */
        .capacity-container { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; }
        .capacity-wrapper { position: relative; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .capacity-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .capacity-circle-bg { fill: none; stroke: rgba(255, 255, 255, 0.1); stroke-width: 3; }
        .capacity-circle-fg { fill: none; stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset 0.6s ease; }
        
        /* Colors */
        .ring-orange { stroke: #ff6b35; filter: drop-shadow(0 0 2px rgba(255, 107, 53, 0.5)); }
        .ring-green { stroke: #22c55e; filter: drop-shadow(0 0 8px rgba(34, 197, 94, 0.8)); }
        
        /* Text */
        .capacity-percent { position: absolute; font-size: 9px; font-family: monospace; font-weight: bold; color: white; }
        .capacity-count { font-size: 9px; color: #888; font-family: 'JetBrains Mono', monospace; font-weight: bold; }
    </style>
</head>
<body>
    <div class="hero-bg"></div>
    <canvas class="film-grain" id="filmGrain"></canvas>

    <div class="p-6 flex items-center justify-between sticky top-0 z-50 bg-gradient-to-b from-black/95 to-transparent backdrop-blur-sm">
        <div class="flex items-center gap-4">
            <button onclick="goBackToHub()" class="group w-10 h-10 flex items-center justify-center rounded-xl border border-white/10 bg-white/5 text-gray-400 hover:border-orange-500 hover:text-orange-500 hover:scale-105 transition-all shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </button>
            
            <div>
                <h1 class="font-display text-3xl font-bold text-white tracking-wide" id="projectTitle">Loading...</h1>
                <p class="text-[10px] text-orange-600 tracking-[0.2em] uppercase mt-1 font-bold">Script Editor Workspace</p>
            </div>
        </div>
        
        <button id="editorToggle" class="group p-3 rounded-xl bg-[#0a0a0a] border border-white/5 hover:border-orange-500 transition-all duration-300 shadow-lg">
            <svg class="w-5 h-5 text-gray-500 group-hover:text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
        </button>
    </div>

    <div class="p-6 max-w-[1600px] mx-auto pb-20">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="sectionsGrid"></div>
    </div>

       <div id="uploadQueue"></div>
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()" async defer></script>
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>
    <script src="main.js">

// ========== PROJECT FILTERING ==========
const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get('id');


function filterScriptsByProject() {
    if (!id) {
        console.log('No project filter - showing all scripts');
        return;
    }

    // Hide all script cards that don't belong to this project
    const allCards = document.querySelectorAll('[data-project-id]');
    allCards.forEach(card => {
        if (card.dataset.projectId !== id) {
            card.style.display = 'none';
        }
    });

    // Update breadcrumb
    const project = projects.find(p => p.id == id);
    if (project) {
        document.title = `${project.title} - Scripts`;
        const breadcrumb = document.getElementById('currentProjectName');
        if (breadcrumb) breadcrumb.textContent = project.title;
    }
}

// Run on page load
window.addEventListener('DOMContentLoaded', filterScriptsByProject);


(function initScriptsPage() {
  const params = new URLSearchParams(window.location.search);
  const projectId = params.get('id'); // [web:36][web:42]

  if (!projectId) {
    window.location.href = 'index.html';
    return;
  }

  let projects = [];
  try {
    const raw = localStorage.getItem('imranProjects'); // [web:26][web:29]
    projects = raw ? JSON.parse(raw) : [];
  } catch (e) {
    projects = [];
  }

  const project = projects.find(p => p.id === projectId);
  if (!project) {
    window.location.href = 'index.html';
    return;
  }

  // Header / breadcrumb me project ka naam dikhane ke liye
  const titleEl = document.getElementById('scriptsProjectTitle');
  if (titleEl) titleEl.textContent = project.title || 'Untitled';

  // yahin se aage: project.scripts array se list render kar sakte ho
})();
</script>

    <!-- PWA Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('/service-worker.js')
            .then((registration) => {
              console.log('✅ ServiceWorker registered:', registration.scope);
            })
            .catch((error) => {
              console.error('❌ ServiceWorker registration failed:', error);
            });
        });
      }
    </script>

</body>
</html>